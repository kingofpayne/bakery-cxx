test_source = Glob('src/**/test_*.cpp') + Glob('src/test_*.cpp')
lib_source = list(set(Glob('src/**/*.cpp') + Glob('src/*.cpp')) - set(test_source))
cpp_flags = ['-Wall', '-std=c++17']
libs = ['boost_filesystem', 'boost_regex', 'boost_system', 'gmp', 'gmpxx']

env = Environment()
env['CPPFLAGS'] = cpp_flags
env['LIBS'] = libs
env.SharedLibrary('bakery', lib_source)

env = Environment()
env['CPPFLAGS'] = cpp_flags + ['-g']
env['LIBS'] = libs + ['bakery']
env['LIBPATH'] = '.'
run_tests = env.Program('run-tests', test_source)

env = Environment()
env['ENV']['LD_LIBRARY_PATH'] = '.'
run_tests_cmd = env.Command('run_tests_cmd', 'run-tests', action='./run-tests')
Depends(run_tests_cmd, run_tests)
